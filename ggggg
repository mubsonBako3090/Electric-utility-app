'use client";
import { useState, useEffect } from 'react'
import Link from 'next/link';
import { useAuth } from '@/contexts/AuthContext';
import { useAuthModal } from '@/components/auth/AuthModal';
import styles from '@/styles/components/Header.module.css';

export default function Header() {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [scrolled, setScrolled] = useState(false);
  const { user, isAuthenticated, logout } = useAuth();
  const { openLogin, openRegister, AuthModalComponent } = useAuthModal();

  // NEW: track if we are client-side to prevent hydration errors
  const [isClient, setIsClient] = useState(false);
  useEffect(() => setIsClient(true), []);

  // Handle scroll effect
  useEffect(() => {
    const handleScroll = () => {
      const isScrolled = window.scrollY > 50;
      setScrolled(isScrolled);
    };

    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const handleLogout = async () => {
    await logout();   // uses AuthContext logout()
    setIsMenuOpen(false);
  };

  const handleLogin = () => {
    openLogin();      // open login modal
    setIsMenuOpen(false);
  };

  const handleRegister = () => {
    openRegister();   // open register modal
    setIsMenuOpen(false);
  };

  return (
    <>
      <nav className={`navbar navbar-expand-lg navbar-light fixed-top ${styles.navbar} ${scrolled ? styles.scrolled : ''}`}>
        <div className="container">

          {/* Brand Logo */}
          <Link href="/" className={`navbar-brand ${styles.brand}`}>
            <i className="bi bi-lightning-charge-fill me-2"></i>
            PowerGrid Utilities
          </Link>

          {/* Mobile Menu Toggle */}
          <button 
            className={`navbar-toggler ${styles.navbarToggler}`}
            type="button"
            onClick={() => setIsMenuOpen(!isMenuOpen)}
            aria-label="Toggle navigation"
          >
            <span className="navbar-toggler-icon"></span>
          </button>

          {/* Navigation Menu */}
          <div className={`collapse navbar-collapse ${isMenuOpen ? 'show' : ''}`}>
            <ul className="navbar-nav ms-auto">

              {/* Navigation Links */}
              <li className="nav-item">
                <Link href="/" className={`nav-link ${styles.navLink}`} onClick={() => setIsMenuOpen(false)}>Home</Link>
              </li>
              <li className="nav-item">
                <Link href="/about" className={`nav-link ${styles.navLink}`} onClick={() => setIsMenuOpen(false)}>About</Link>
              </li>
              <li className="nav-item">
                <Link href="/services" className={`nav-link ${styles.navLink}`} onClick={() => setIsMenuOpen(false)}>Services</Link>
              </li>
              <li className="nav-item">
                <Link href="/outagemap" className={`nav-link ${styles.navLink}`} onClick={() => setIsMenuOpen(false)}>Outage Map</Link>
              </li>
              <li className="nav-item">
                <Link href="/contact" className={`nav-link ${styles.navLink}`} onClick={() => setIsMenuOpen(false)}>Contact</Link>
              </li>

              {/* Authentication Section */}
              {isClient && (isAuthenticated ? (
                <li className="nav-item dropdown">
                  <a 
                    className={`nav-link dropdown-toggle ${styles.navLink} ${styles.userDropdown}`} 
                    href="#" 
                    role="button" 
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <i className="bi bi-person-circle me-1"></i>
                    {user?.firstName}
                  </a>

                  <ul className={`dropdown-menu ${styles.dropdownMenu}`}>
                    <li>
                      <Link href="/dashboard" className="dropdown-item" onClick={() => setIsMenuOpen(false)}>
                        <i className="bi bi-speedometer2 me-2"></i> Dashboard
                      </Link>
                    </li>
                    <li>
                      <Link href="/profile" className="dropdown-item" onClick={() => setIsMenuOpen(false)}>
                        <i className="bi bi-person me-2"></i> My Profile
                      </Link>
                    </li>
                    <li>
                      <Link href="/bills" className="dropdown-item" onClick={() => setIsMenuOpen(false)}>
                        <i className="bi bi-receipt me-2"></i> My Bills
                      </Link>
                    </li>
                    <li><hr className="dropdown-divider" /></li>
                    <li>
                      <button 
                        className="dropdown-item text-danger"
                        onClick={handleLogout}
                      >
                        <i className="bi bi-box-arrow-right me-2"></i> Logout
                      </button>
                    </li>
                  </ul>
                </li>
              ) : (
                <li className="nav-item">
                  <div className={styles.authButtons}>
                    <button 
                      className={`btn btn-outline-primary me-2 ${styles.authBtn}`}
                      onClick={handleLogin}
                    >
                      <i className="bi bi-person-circle me-2"></i> Login
                    </button>
                    <button 
                      className={`btn btn-primary ${styles.authBtn}`}
                      onClick={handleRegister}
                    >
                      <i className="bi bi-person-plus me-2"></i> Register
                    </button>
                  </div>
                </li>
              ))}

            </ul>
          </div>
        </div>
      </nav>

      {/* Auth Modal */}
      <AuthModalComponent />
    </>
  );
}

'use client';
import { useState, useEffect } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import Footer from '@/components/Footer';
import BillList from '@/components/bills/BillList';
import PaymentForm from '@/components/bills/PaymentForm';
import styles from '@/styles/pages/Bills.module.css';
import Header from '@/components/ui/Header';
import Link from "next/link";

export default function Bills() {
  const { user, isAuthenticated, loading } = useAuth();
  const [bills, setBills] = useState([]);
  const [selectedBill, setSelectedBill] = useState(null);
  const [showPaymentForm, setShowPaymentForm] = useState(false);
  const [filter, setFilter] = useState('all');

  useEffect(() => {
    if (isAuthenticated) {
      fetchBills();
    }
  }, [isAuthenticated]);

  const fetchBills = async () => {
    try {
      // Simulate API call
      setTimeout(() => {
        const mockBills = [
          {
            id: 1,
            billNumber: 'BL202401001',
            billingPeriod: {
              start: '2023-12-01',
              end: '2023-12-31'
            },
            dueDate: '2024-01-15',
            energyUsage: 450,
            rate: 0.15,
            energyCharge: 67.50,
            serviceFee: 15.00,
            taxes: 8.25,
            totalAmount: 125.75,
            amountDue: 125.75,
            status: 'pending',
            paidAt: null
          },
          {
            id: 2,
            billNumber: 'BL202312001',
            billingPeriod: {
              start: '2023-11-01',
              end: '2023-11-30'
            },
            dueDate: '2023-12-15',
            energyUsage: 420,
            rate: 0.15,
            energyCharge: 63.00,
            serviceFee: 15.00,
            taxes: 7.80,
            totalAmount: 120.80,
            amountDue: 0,
            status: 'paid',
            paidAt: '2023-12-10'
          },
          {
            id: 3,
            billNumber: 'BL202311001',
            billingPeriod: {
              start: '2023-10-01',
              end: '2023-10-31'
            },
            dueDate: '2023-11-15',
            energyUsage: 480,
            rate: 0.15,
            energyCharge: 72.00,
            serviceFee: 15.00,
            taxes: 8.70,
            totalAmount: 130.70,
            amountDue: 0,
            status: 'paid',
            paidAt: '2023-11-12'
          }
        ];
        setBills(mockBills);
      }, 1000);
    } catch (error) {
      console.error('Failed to fetch bills:', error);
    }
  };

  const handlePayment = (bill) => {
    setSelectedBill(bill);
    setShowPaymentForm(true);
  };

  const handlePaymentSubmit = async (paymentData) => {
    console.log('Processing payment:', paymentData);
    // capture id before clearing selectedBill
    const paidId = selectedBill?.id;
    // API call would go here
    setShowPaymentForm(false);
    setSelectedBill(null);
    
    // Update bill status locally
    if (paidId != null) {
      setBills(prevBills =>
        prevBills.map(bill =>
          bill.id === paidId
            ? { ...bill, status: 'paid', amountDue: 0, paidAt: new Date().toISOString() }
            : bill
        )
      );
    }
    
    alert('Payment processed successfully!');
  };

  const filteredBills = bills.filter(bill => {
    if (filter === 'all') return true;
    if (filter === 'pending') return bill.status === 'pending';
    if (filter === 'paid') return bill.status === 'paid';
    if (filter === 'overdue') return bill.status === 'pending' && new Date(bill.dueDate) < new Date();
    return true;
  });

  const totalPending = bills.filter(bill => bill.status === 'pending').reduce((sum, bill) => sum + bill.amountDue, 0);
  const totalPaid = bills.filter(bill => bill.status === 'paid').reduce((sum, bill) => sum + bill.totalAmount, 0);

  if (loading) {
    return (
      <>
        <Header />
        <div className={styles.loadingContainer}>
          <div className="spinner-border text-primary" role="status">
            <span className="visually-hidden">Loading...</span>
          </div>
        </div>
        <Footer />
      </>
    );
  }

  if (!isAuthenticated) {
    return (
      <>
        <Header />
        <div className={styles.unauthorized}>
          <div className="container text-center">
            <i className="bi bi-shield-exclamation"></i>
            <h2>Access Denied</h2>
            <p>Please log in to view your bills.</p>
          </div>
        </div>
        <Footer />
      </>
    );
  }

  return (
    <>
      <header />

      <div className={styles.bills}>
        {/* Header Section */}
        <section className={styles.billsHeader}>
          <div className="container">
            <div className="row align-items-center">
              <div className="col-md-8">
                <h1>My Bills</h1>
                <p className={styles.billsSubtitle}>
                  View and manage your electricity bills
                </p>
              </div>
              <div className="col-md-4 text-md-end">
                <div className={styles.billSummary}>
                  <p><strong>Total Pending:</strong> ${totalPending.toFixed(2)}</p>
                  <p><strong>Total Paid This Year:</strong> ${totalPaid.toFixed(2)}</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* Quick Stats */}
        <section className={styles.quickStats}>
          <div className="container">
            <div className="row">
              <div className="col-md-3 mb-3">
                <div className={styles.statCard}>
                  <i className="bi bi-receipt"></i>
                  <div>
                    <h3>${totalPending.toFixed(2)}</h3>
                    <p>Amount Due</p>
                  </div>
                </div>
              </div>
              <div className="col-md-3 mb-3">
                <div className={styles.statCard}>
                  <i className="bi bi-credit-card"></i>
                  <div>
                    <h3>{bills.filter(b => b.status === 'pending').length}</h3>
                    <p>Pending Bills</p>
                  </div>
                </div>
              </div>
              <div className="col-md-3 mb-3">
                <div className={styles.statCard}>
                  <i className="bi bi-check-circle"></i>
                  <div>
                    <h3>{bills.filter(b => b.status === 'paid').length}</h3>
                    <p>Paid Bills</p>
                  </div>
                </div>
              </div>
              <div className="col-md-3 mb-3">
                <div className={styles.statCard}>
                  <i className="bi bi-graph-up"></i>
                  <div>
                    <h3>${totalPaid.toFixed(2)}</h3>
                    <p>Total Paid</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* Bills Content */}
        <section className="section-padding">
          <div className="container">
            {/* Filter Tabs */}
            <div className={styles.filterTabs}>
              <div className="row align-items-center">
                <div className="col-md-6">
                  <h3>Billing History</h3>
                </div>
                <div className="col-md-6">
                  <div className={styles.filterButtons}>
                    <button
                      className={`btn ${filter === 'all' ? 'btn-primary' : 'btn-outline-primary'}`}
                      onClick={() => setFilter('all')}
                    >
                      All Bills
                    </button>
                    <button
                      className={`btn ${filter === 'pending' ? 'btn-primary' : 'btn-outline-primary'}`}
                      onClick={() => setFilter('pending')}
                    >
                      Pending
                    </button>
                    <button
                      className={`btn ${filter === 'paid' ? 'btn-primary' : 'btn-outline-primary'}`}
                      onClick={() => setFilter('paid')}
                    >
                      Paid
                    </button>
                    <button
                      className={`btn ${filter === 'overdue' ? 'btn-primary' : 'btn-outline-primary'}`}
                      onClick={() => setFilter('overdue')}
                    >
                      Overdue
                    </button>
                  </div>
                </div>
              </div>
            </div>

            {/* Bills List */}
            <BillList
              bills={filteredBills}
              onPayment={handlePayment}
              loading={loading}
            />

            {/* Empty State */}
            {filteredBills.length === 0 && !loading && (
              <div className={styles.emptyState}>
                <i className="bi bi-receipt"></i>
                <h4>No bills found</h4>
                <p>There are no bills matching your current filter.</p>
              </div>
            )}
          </div>
        </section>

        {/* Payment Methods */}
        <section className={`section-padding bg-light ${styles.paymentMethods}`}>
          <div className="container">
            <div className="text-center mb-5">
              <h2 className="section-title">Payment Methods</h2>
            </div>
            <div className="row">
              <div className="col-md-4 text-center mb-4">
                <div className={styles.paymentMethod}>
                  <i className="bi bi-credit-card"></i>
                  <h5>Credit/Debit Card</h5>
                  <p>Secure online payments with instant confirmation</p>
                </div>
              </div>
              <div className="col-md-4 text-center mb-4">
                <div className={styles.paymentMethod}>
                  <i className="bi bi-bank"></i>
                  <h5>Bank Transfer</h5>
                  <p>Direct transfer from your bank account</p>
                </div>
              </div>
              <div className="col-md-4 text-center mb-4">
                <div className={styles.paymentMethod}>
                  <i className="bi bi-wallet2"></i>
                  <h5>Auto-Pay</h5>
                  <p>Set up automatic payments for worry-free billing</p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>

      {/* Payment Form Modal */}
      {showPaymentForm && (
        <PaymentForm
          bill={selectedBill}
          onClose={() => {
            setShowPaymentForm(false);
            setSelectedBill(null);
          }}
          onSubmit={handlePaymentSubmit}
        />
      )}
       <Footer />
    </>
  );
  
}
Phase 1: The Essential Dashboard "At-a-Glance" View

This is the first screen the customer sees after login. It should answer their most common questions instantly.

1. Account Summary Card:
   · Account Number & Name
   · Current Balance (prominently displayed). Use color (red for owed, black/neutral for credit/zero).
   · Due Date & "Pay Now" button (the most important action).
   · Status Indicator: "Payment Due," "Credit," "Payment Scheduled," "Past Due," etc.
2. Usage & Cost Snapshot:
   · Current Bill To Date: Estimated cost for the current, incomplete billing cycle.
   · Comparison Data: "You've used 15% more electricity than last month" or "Your projected bill is $XX vs. $YY last month." This creates engagement.
   · A simple bar chart for the last 6 months of consumption/cost.
3. Critical Alerts/Notifications Center:
   · High usage alert, payment reminder, outage in your area, meter reading notification. Use a dedicated bell icon with a badge count.
   · This makes the app feel proactive and essential.
4. Quick Actions Bar/Floating Button:
   · Icon-based shortcuts for: Pay Bill, Report Outage, View Usage, Contact Us.

Phase 2: Primary Navigation & Core Features

Structure the app with a bottom navigation bar or a hamburger menu for these sections:

1. Billing & Payments (Top Priority):
   · Current & Past Bills: PDF download/view.
   · Payment History: A list of all transactions.
   · Payment Methods: Add/remove bank accounts, cards, set up auto-pay.
   · Payment Arrangements/Schedule Payment.
2. Energy Usage (High Engagement):
   · Interactive Charts: Daily, hourly usage. Allow comparisons (e.g., vs. last week, vs. same month last year).
   · Breakdown by Cost/Consumption.
   · Tips to Save: Personalized suggestions based on usage patterns. ("You use more energy on weekends. Consider...")
3. Account & Settings:
   · Update contact info, password, communication preferences (email/SMS for outages/bills).
   · Paperless billing enrollment.
   · Service Address & Meter Info.

Phase 3: Enhanced Features for Stickiness & Value

1. Outage Management:
   · Map of Outages in the service area.
   · Report an Outage with one tap (using location/account info).
   · Outage Status Updates & Estimated Restoration Time (ERT).
2. Move-In / Move-Out Service.
3. Programs & Rebates: Link to energy efficiency rebates, EV charger programs, etc.
4. Secure Messaging (instead of calling support for non-urgent matters).

Technical & UX Next Steps for You:

· API Integration: Connect to your backend to fetch real:
  · Account & Balance data.
  · Billing history.
  · Usage data (hourly/daily if available from AMI meters).
· State Management: Ensure sensitive data is handled securely and the app state is managed properly (logged in/out).
· Focus on One Flow: Don't build all pages at once. Build the "Pay Bill" flow end-to-end first. This is the core transaction.
  · Dashboard Pay Now button -> Enter Amount -> Choose Payment Method -> Confirm -> Receipt.
· Design for Clarity, Not Beauty: Utility data can be complex. Use clear labels, consistent number formatting, and explain terms (e.g., "kWh," "Supply vs. Delivery Charges") in tooltips.

Suggested Development Order (Agile Sprints):

1. Sprint 1: Dashboard Core + Static Pay Button.
   · Build the dashboard UI with placeholder data.
   · Implement a "Pay Now" button that links to a simple webview or a static page.
2. Sprint 2: Real Data & Simple Payment.
   · Connect the dashboard to live APIs for Account Summary, Balance, and Last Bill.
   · Implement the native payment flow (at least for adding a card and making a one-time payment).
3. Sprint 3: Billing History & Usage Page.
   · Create the bills list and usage chart pages with real data.
4. Sprint 4: Notifications & Outage Reporting.
   · Implement push notification infrastructure and the outage reporting map/tool.

Pro Tip: Always include a "Log Out" button in a logical place (usually in Account/Settings).

By following this approach, you move from a simple login to a functional, valuable application that customers will want to use regularly. Start with the dashboard essentials and the payment flow, then expand based on user needs and data availability. Good luck
